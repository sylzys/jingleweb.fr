(function happyJS(c){function b(d){return("".trim)?d.val().trim():c.trim(d.val())}c.fn.isHappy=function a(f){var i=[],n;var m=false;function e(o){return !!(o&&o.constructor&&o.call&&o.apply)}function j(o){var p=f.classes&&f.classes.message||"unhappyMessage";return c('<span id="'+o.id+'" class="'+p+'" role="alert">'+o.message+"</span>")}function g(o){if(e(f.errorTemplate)){return f.errorTemplate(o)}return j(o)}function h(){var p,o;var q=false;for(p=0,o=i.length;p<o;p+=1){if(!i[p].testValid(true)){q=true}}if(q){if(e(f.unHappy)){f.unHappy()}return false}else{if(f.testMode){if(e(f.happy)){f.happy()}if(window.console){console.warn("would have submitted")}return false}}if(e(f.happy)){f.happy()}}function l(){m=false}function d(){m=true;c(window).bind("mouseup",l)}function k(r,o){var t=c(o);var p={message:r.message||"",id:o.slice(1)+"_unhappy"};var u=c(p.id).length>0?c(p.id):g(p);var q=function q(){if(!m){t.testValid()}else{c(window).bind("mouseup",t.testValid.bind(this))}};i.push(t);t.testValid=function s(A){var w,y,E;var v=c(this);var x=(r.errorTarget&&c(r.errorTarget))||v;var B=false;var z=!!v.get(0).attributes.getNamedItem("required")||r.required;var D=(t.attr("type")==="password");var F=e(r.arg)?r.arg():r.arg;var C=f.classes&&f.classes.field||"unhappy";if(v.length>1){w=[];v.each(function(G,H){w.push(c(H).val())});w=w.join(",")}else{if(e(r.clean)){w=r.clean(v.val())}else{if(!D&&typeof r.trim==="undefined"||r.trim){w=b(v)}else{w=v.val()}}v.val(w)}y=((w.length>0||z==="sometimes")&&e(r.test));if(A===true&&z===true&&w.length===0){B=true}else{if(y){B=!r.test(w,F)}}if(B){x.addClass(C).after(u);return false}else{E=u.get(0);if(E.parentNode){E.parentNode.removeChild(E)}x.removeClass(C);return true}};t.bind(r.when||f.when||"blur",q)}for(n in f.fields){k(f.fields[n],n)}c(f.submitButton||this).bind("mousedown",d);if(f.submitButton){c(f.submitButton).click(h)}else{this.bind("submit",h)}return this}})(this.jQuery||this.Zepto);